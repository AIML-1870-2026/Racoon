<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RGB Color Explorer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: #fff;
            padding: 20px;
            transition: filter 0.3s ease;
        }

        body.filter-protanopia { filter: url(#protanopia-filter); }
        body.filter-deuteranopia { filter: url(#deuteranopia-filter); }
        body.filter-tritanopia { filter: url(#tritanopia-filter); }
        body.filter-protanomaly { filter: url(#protanomaly-filter); }
        body.filter-deuteranomaly { filter: url(#deuteranomaly-filter); }
        body.filter-tritanomaly { filter: url(#tritanomaly-filter); }
        body.filter-achromatopsia { filter: url(#achromatopsia-filter); }

        h1 {
            text-align: center;
            margin-bottom: 10px;
            font-size: 2.5rem;
            background: linear-gradient(90deg, #ff6b6b, #4ecdc4, #45b7d1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            text-align: center;
            color: #888;
            margin-bottom: 30px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1.5fr 1fr;
            gap: 20px;
        }

        @media (max-width: 900px) {
            .container {
                grid-template-columns: 1fr;
            }
        }

        .panel {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            padding: 24px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .panel h2 {
            font-size: 1.3rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .panel h2 span {
            font-size: 1.5rem;
        }

        /* RGB Mixer - Flashlight Visualization */
        .flashlight-container {
            position: relative;
            width: 100%;
            height: 250px;
            background: #000;
            border-radius: 12px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .light-stage {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            mix-blend-mode: screen;
        }

        .light-beam {
            position: absolute;
            transition: opacity 0.1s;
            filter: blur(20px);
        }

        .light-beam.red {
            top: 35px;
            left: 50%;
            transform: translateX(-50%);
            width: 280px;
            height: 220px;
            background: radial-gradient(ellipse at 50% 0%, rgba(255, 0, 0, 1) 0%, rgba(255, 0, 0, 0.6) 50%, rgba(255, 0, 0, 0) 80%);
            clip-path: polygon(50% 0%, 0% 100%, 100% 100%);
        }

        .light-beam.green {
            bottom: 30px;
            left: 25px;
            width: 320px;
            height: 320px;
            background: radial-gradient(ellipse at 0% 100%, rgba(0, 255, 0, 1) 0%, rgba(0, 255, 0, 0.6) 50%, rgba(0, 255, 0, 0) 85%);
            clip-path: polygon(0% 100%, 50% 0%, 100% 60%);
            transform: rotate(35deg);
            transform-origin: 0% 100%;
        }

        .light-beam.blue {
            bottom: 30px;
            right: 25px;
            width: 320px;
            height: 320px;
            background: radial-gradient(ellipse at 100% 100%, rgba(0, 0, 255, 1) 0%, rgba(0, 0, 255, 0.6) 50%, rgba(0, 0, 255, 0) 85%);
            clip-path: polygon(100% 100%, 50% 0%, 0% 60%);
            transform: rotate(-35deg);
            transform-origin: 100% 100%;
        }

        .flashlight {
            position: absolute;
            width: 40px;
            height: 60px;
            z-index: 10;
            transition: opacity 0.3s;
        }

        .flashlight-body {
            width: 100%;
            height: 40px;
            background: linear-gradient(to bottom, #555, #333);
            border-radius: 5px 5px 8px 8px;
            position: relative;
        }

        .flashlight-head {
            width: 30px;
            height: 20px;
            background: linear-gradient(to bottom, #666, #444);
            border-radius: 50% 50% 0 0;
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
        }

        .flashlight-lens {
            width: 20px;
            height: 8px;
            background: rgba(255,255,255,0.3);
            border-radius: 50%;
            position: absolute;
            top: -12px;
            left: 50%;
            transform: translateX(-50%);
        }

        .flashlight.red-flashlight {
            top: -5px;
            left: 50%;
            transform: translateX(-50%) rotate(180deg);
        }

        .flashlight.red-flashlight .flashlight-lens {
            background: rgba(255,100,100,0.8);
            box-shadow: 0 0 15px rgba(255,0,0,1);
        }

        .flashlight.green-flashlight {
            bottom: 10px;
            left: 5px;
            transform: rotate(85deg);
        }

        .flashlight.green-flashlight .flashlight-lens {
            background: rgba(100,255,100,0.8);
            box-shadow: 0 0 15px rgba(0,255,0,1);
        }

        .flashlight.blue-flashlight {
            bottom: 10px;
            right: 5px;
            transform: rotate(-85deg);
        }

        .flashlight.blue-flashlight .flashlight-lens {
            background: rgba(100,100,255,0.8);
            box-shadow: 0 0 15px rgba(0,0,255,1);
        }

        .color-result {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.7);
            padding: 8px 16px;
            border-radius: 20px;
            font-family: monospace;
            font-size: 1rem;
            font-weight: bold;
            z-index: 20;
        }

        .mix-point {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 3px solid rgba(255,255,255,0.8);
            z-index: 15;
            box-shadow: 0 0 15px rgba(255,255,255,0.5), inset 0 0 20px rgba(0,0,0,0.3);
            transition: background-color 0.2s, box-shadow 0.2s;
        }

        .mix-point::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 10px;
            height: 10px;
            background: rgba(255,255,255,0.9);
            border-radius: 50%;
        }

        .slider-group {
            margin-bottom: 15px;
        }

        .slider-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .slider-label span:first-child {
            font-weight: bold;
        }

        input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            outline: none;
            -webkit-appearance: none;
            appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #fff;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
        }

        .red-slider { background: linear-gradient(to right, #000, #f00); }
        .green-slider { background: linear-gradient(to right, #000, #0f0); }
        .blue-slider { background: linear-gradient(to right, #000, #00f); }

        .mixer-top {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .flashlight-container {
            flex: 1;
        }

        .primary-pickers-wrapper {
            display: flex;
            flex-direction: column;
            justify-content: center;
            min-width: 140px;
            gap: 15px;
        }

        .primary-picker {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .primary-picker-label {
            font-size: 0.8rem;
            color: #888;
            font-weight: bold;
        }

        .primary-picker-buttons {
            display: flex;
            gap: 5px;
        }

        .primary-btn {
            padding: 8px 12px;
            border-radius: 6px;
            border: 2px solid transparent;
            cursor: pointer;
            font-weight: bold;
            font-size: 0.75rem;
            transition: all 0.2s;
            opacity: 0.5;
        }

        .primary-btn.selected {
            opacity: 1;
        }

        .primary-btn.red-btn {
            background: rgba(255, 0, 0, 0.2);
            color: #ff6b6b;
        }

        .primary-btn.red-btn.selected {
            border-color: #ff6b6b;
            background: rgba(255, 0, 0, 0.4);
        }

        .primary-btn.green-btn {
            background: rgba(0, 255, 0, 0.2);
            color: #4ecdc4;
        }

        .primary-btn.green-btn.selected {
            border-color: #4ecdc4;
            background: rgba(0, 255, 0, 0.4);
        }

        .primary-btn.blue-btn {
            background: rgba(0, 0, 255, 0.2);
            color: #45b7d1;
        }

        .primary-btn.blue-btn.selected {
            border-color: #45b7d1;
            background: rgba(0, 0, 255, 0.4);
        }

        .primary-btn:disabled {
            opacity: 0.25;
            cursor: not-allowed;
            background: rgba(50, 50, 50, 0.3);
            color: #555;
            border-color: transparent;
            text-decoration: line-through;
        }

        .slider-group.lightness-slider .slider-label span:first-child::after {
            content: ' — adds lightness';
            font-size: 0.7rem;
            color: #888;
            font-weight: normal;
        }

        .slider-wrapper {
            position: relative;
            width: 100%;
            height: 8px;
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
        }

        .slider-wrapper input[type="range"] {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            transition: width 0.2s;
        }

        .slider-wrapper input[type="range"].capped {
            /* Width will be set dynamically via JS */
        }

        .cap-marker {
            position: absolute;
            top: -4px;
            width: 3px;
            height: 16px;
            background: #fff;
            border-radius: 2px;
            box-shadow: 0 0 5px rgba(255,255,255,0.8);
            transition: left 0.2s;
            z-index: 5;
        }

        .cap-marker::after {
            content: 'MAX';
            position: absolute;
            top: -16px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.55rem;
            color: #888;
            white-space: nowrap;
        }

        .slider-disabled-zone {
            position: absolute;
            top: 0;
            right: 0;
            height: 100%;
            background: rgba(0,0,0,0.5);
            border-radius: 0 4px 4px 0;
            pointer-events: none;
            z-index: 3;
        }

        .color-explanation {
            margin-top: 15px;
            padding: 10px 12px;
            background: rgba(0,0,0,0.3);
            border-radius: 8px;
            font-size: 0.85rem;
            color: #ccc;
            line-height: 1.4;
        }

        .color-explanation .mix-result {
            font-weight: bold;
            margin-right: 5px;
        }

        /* Color Wheel */
        .color-wheel-section {
            margin-top: 25px;
            text-align: center;
        }

        .color-wheel-section h3 {
            font-size: 1rem;
            margin-bottom: 15px;
            color: #888;
        }

        .color-wheel-row {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
        }

        .color-wheel-container {
            position: relative;
            width: 420px;
            height: 420px;
        }

        .wheel-side-controls {
            display: flex;
            flex-direction: column;
            gap: 10px;
            align-items: flex-start;
            text-align: left;
            margin-left: 20px;
        }

        #colorWheel {
            border-radius: 50%;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }

        .wheel-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 84px;
            height: 84px;
            border-radius: 50%;
            background: #1a1a2e;
            border: 2px solid rgba(255,255,255,0.2);
        }

        .colors-discovered {
            font-size: 0.85rem;
            color: #888;
            margin: 0;
        }

        .colors-discovered span {
            color: #4ecdc4;
            font-weight: bold;
        }

        .reveal-btn {
            padding: 8px 16px;
            font-size: 0.85rem;
        }

        .reveal-btn.active {
            background: rgba(78, 205, 196, 0.3);
            border-color: #4ecdc4;
        }

        #colorWheelFull {
            position: absolute;
            top: 0;
            left: 0;
            border-radius: 50%;
        }

        /* Collapsible Side Panel */
        .side-panel {
            position: fixed;
            top: 0;
            right: -320px;
            width: 320px;
            height: 100vh;
            background: rgba(26, 26, 46, 0.98);
            backdrop-filter: blur(10px);
            border-left: 1px solid rgba(255, 255, 255, 0.1);
            padding: 20px;
            z-index: 1000;
            transition: right 0.3s ease;
            overflow-y: auto;
        }

        .side-panel.open {
            right: 0;
        }

        .side-panel h2 {
            margin-bottom: 15px;
            padding-right: 40px;
        }

        .side-panel-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            width: 45px;
            height: 45px;
            border-radius: 8px;
            cursor: pointer;
            z-index: 1001;
            transition: background 0.2s;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 5px;
            padding: 10px;
        }

        .side-panel-toggle:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .side-panel-toggle .menu-line {
            width: 24px;
            height: 3px;
            background: #fff;
            border-radius: 2px;
            transition: transform 0.3s, opacity 0.3s;
        }

        .side-panel-toggle.open .menu-line:nth-child(1) {
            transform: rotate(45deg) translate(5px, 6px);
        }

        .side-panel-toggle.open .menu-line:nth-child(2) {
            opacity: 0;
        }

        .side-panel-toggle.open .menu-line:nth-child(3) {
            transform: rotate(-45deg) translate(5px, -6px);
        }

        .side-panel-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: #fff;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .side-panel-close:hover {
            background: rgba(255, 107, 107, 0.3);
        }

        .sliders-and-values {
            display: flex;
            gap: 20px;
            align-items: flex-start;
        }

        .sliders-container {
            flex: 1;
        }

        .color-values {
            display: flex;
            flex-direction: column;
            gap: 8px;
            min-width: 100px;
        }

        .color-value-box {
            background: rgba(0,0,0,0.3);
            padding: 8px 12px;
            border-radius: 8px;
            text-align: center;
            font-family: monospace;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .color-value-box label {
            color: #888;
            font-size: 0.7rem;
            min-width: 28px;
        }

        /* Palette Generator */
        .palette-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        button {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-secondary {
            background: rgba(255,255,255,0.1);
            color: white;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .btn-secondary.active {
            background: rgba(78, 205, 196, 0.3);
            border-color: #4ecdc4;
        }

        .palette-type-select {
            padding: 10px 15px;
            border-radius: 8px;
            background: rgba(255,255,255,0.1);
            color: white;
            border: 1px solid rgba(255,255,255,0.2);
            font-size: 1rem;
        }

        .palette-type-select option {
            background: #1a1a2e;
        }

        .palette-display {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .palette-color {
            flex: 1;
            min-width: 60px;
            height: 70px;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-end;
            padding: 8px;
            cursor: pointer;
            transition: transform 0.2s;
            position: relative;
        }

        .palette-color:hover {
            transform: scale(1.05);
        }

        .palette-color span {
            font-size: 0.65rem;
            font-weight: bold;
            text-shadow: 0 1px 3px rgba(0,0,0,0.5);
            background: rgba(0,0,0,0.3);
            padding: 3px 6px;
            border-radius: 4px;
        }

        .palette-color.selected-text {
            outline: 3px solid #ff6b6b;
            outline-offset: 2px;
        }

        .palette-color.selected-bg {
            outline: 3px solid #4ecdc4;
            outline-offset: 2px;
        }

        .palette-color.selected-text.selected-bg {
            outline: 3px solid;
            outline-color: #ff6b6b;
            box-shadow: 0 0 0 6px #4ecdc4;
        }

        .palette-color .selection-indicator {
            position: absolute;
            top: 4px;
            left: 4px;
            font-size: 0.6rem;
            padding: 2px 4px;
            border-radius: 3px;
            font-weight: bold;
        }

        .palette-color .selection-indicator.text-indicator {
            background: #ff6b6b;
            color: #fff;
        }

        .palette-color .selection-indicator.bg-indicator {
            background: #4ecdc4;
            color: #000;
            left: auto;
            right: 4px;
        }

        .accessible-badge {
            position: absolute;
            top: 8px;
            right: 8px;
            font-size: 0.65rem;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: bold;
        }

        .badge-aaa {
            background: #4ecdc4;
            color: #000;
        }

        .badge-aa {
            background: #f9ca24;
            color: #000;
        }

        /* Contrast Checker */
        .contrast-colors {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .contrast-color-picker {
            text-align: center;
        }

        .contrast-color-picker label {
            display: block;
            margin-bottom: 8px;
            color: #888;
        }

        .contrast-color-picker input[type="color"] {
            width: 80px;
            height: 50px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }

        .hex-input {
            width: 100%;
            padding: 8px 12px;
            margin-top: 8px;
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 6px;
            background: rgba(0,0,0,0.3);
            color: #fff;
            font-family: monospace;
            font-size: 0.9rem;
            text-align: center;
            text-transform: uppercase;
        }

        .hex-input:focus {
            outline: none;
            border-color: #4ecdc4;
        }

        .hex-input.invalid {
            border-color: #ff6b6b;
        }

        .select-mode-btns {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .select-mode-btn {
            flex: 1;
            padding: 8px;
            font-size: 0.85rem;
        }

        .select-mode-btn.active-text {
            background: rgba(255, 107, 107, 0.3);
            border-color: #ff6b6b;
        }

        .select-mode-btn.active-bg {
            background: rgba(78, 205, 196, 0.3);
            border-color: #4ecdc4;
        }

        .contrast-preview {
            padding: 30px;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 20px;
        }

        .contrast-preview h3 {
            font-size: 1.5rem;
            margin-bottom: 10px;
        }

        .contrast-preview p {
            font-size: 1rem;
        }

        .contrast-result {
            background: rgba(0,0,0,0.3);
            padding: 20px;
            border-radius: 12px;
        }

        .contrast-ratio {
            font-size: 2.5rem;
            font-weight: bold;
            text-align: center;
            margin-bottom: 15px;
        }

        .wcag-results {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .wcag-item {
            padding: 12px;
            border-radius: 8px;
            text-align: center;
        }

        .wcag-item.pass {
            background: rgba(78, 205, 196, 0.2);
            border: 1px solid #4ecdc4;
        }

        .wcag-item.fail {
            background: rgba(255, 107, 107, 0.2);
            border: 1px solid #ff6b6b;
        }

        .wcag-item .level {
            font-weight: bold;
            font-size: 1.1rem;
        }

        .wcag-item .status {
            font-size: 0.85rem;
            margin-top: 4px;
        }

        /* Color Blindness Simulator */
        .blindness-options {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-bottom: 20px;
        }

        .blindness-option {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 15px;
            background: rgba(0,0,0,0.2);
            border-radius: 10px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s;
        }

        .blindness-option:hover {
            background: rgba(255,255,255,0.05);
            border-color: rgba(255,255,255,0.2);
        }

        .blindness-option.selected {
            background: rgba(78, 205, 196, 0.15);
            border-color: #4ecdc4;
        }

        .blindness-option input[type="radio"] {
            display: none;
        }

        .blindness-radio {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 2px solid rgba(255,255,255,0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .blindness-option.selected .blindness-radio {
            border-color: #4ecdc4;
        }

        .blindness-option.selected .blindness-radio::after {
            content: '';
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #4ecdc4;
        }

        .blindness-label {
            flex: 1;
        }

        .blindness-label strong {
            display: block;
            font-size: 0.95rem;
            margin-bottom: 2px;
        }

        .blindness-label span {
            font-size: 0.8rem;
            color: #888;
        }


        /* Accessible Mode Panel */
        .mode-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .mode-btn {
            flex: 1;
            padding: 15px;
            text-align: center;
        }

        .mode-btn.active {
            background: linear-gradient(135deg, #4ecdc4, #44a08d);
        }

        .accessible-palette {
            margin-top: 20px;
        }

        .accessible-pair {
            display: flex;
            margin-bottom: 15px;
            border-radius: 12px;
            overflow: hidden;
        }

        .accessible-fg, .accessible-bg {
            flex: 1;
            padding: 20px;
            text-align: center;
        }

        .accessible-pair-info {
            background: rgba(0,0,0,0.3);
            padding: 10px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .copy-notification {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #4ecdc4;
            color: #000;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: bold;
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
        }

        .copy-notification.show {
            opacity: 1;
        }

        @media (max-width: 500px) {
            .container {
                grid-template-columns: 1fr;
            }

            .panel {
                padding: 16px;
            }

            h1 {
                font-size: 1.8rem;
            }
        }
    </style>
</head>
<body>
    <!-- SVG Filters for Color Blindness Simulation -->
    <svg style="display: none;">
        <defs>
            <filter id="protanopia-filter">
                <feColorMatrix type="matrix" values="
                    0.567, 0.433, 0,     0, 0
                    0.558, 0.442, 0,     0, 0
                    0,     0.242, 0.758, 0, 0
                    0,     0,     0,     1, 0"/>
            </filter>
            <filter id="deuteranopia-filter">
                <feColorMatrix type="matrix" values="
                    0.625, 0.375, 0,   0, 0
                    0.7,   0.3,   0,   0, 0
                    0,     0.3,   0.7, 0, 0
                    0,     0,     0,   1, 0"/>
            </filter>
            <filter id="tritanopia-filter">
                <feColorMatrix type="matrix" values="
                    0.95, 0.05,  0,     0, 0
                    0,    0.433, 0.567, 0, 0
                    0,    0.475, 0.525, 0, 0
                    0,    0,     0,     1, 0"/>
            </filter>
            <filter id="protanomaly-filter">
                <feColorMatrix type="matrix" values="
                    0.817, 0.183, 0,     0, 0
                    0.333, 0.667, 0,     0, 0
                    0,     0.125, 0.875, 0, 0
                    0,     0,     0,     1, 0"/>
            </filter>
            <filter id="deuteranomaly-filter">
                <feColorMatrix type="matrix" values="
                    0.8,   0.2,   0,     0, 0
                    0.258, 0.742, 0,     0, 0
                    0,     0.142, 0.858, 0, 0
                    0,     0,     0,     1, 0"/>
            </filter>
            <filter id="tritanomaly-filter">
                <feColorMatrix type="matrix" values="
                    0.967, 0.033, 0,     0, 0
                    0,     0.733, 0.267, 0, 0
                    0,     0.183, 0.817, 0, 0
                    0,     0,     0,     1, 0"/>
            </filter>
            <filter id="achromatopsia-filter">
                <feColorMatrix type="matrix" values="
                    0.299, 0.587, 0.114, 0, 0
                    0.299, 0.587, 0.114, 0, 0
                    0.299, 0.587, 0.114, 0, 0
                    0,     0,     0,     1, 0"/>
            </filter>
        </defs>
    </svg>

    <h1>RGB Color Explorer</h1>
    <p class="subtitle">Mix colors, generate palettes, check accessibility, and simulate color blindness</p>

    <div class="container">
        <!-- RGB Mixer Panel -->
        <div class="panel">
            <h2>RGB Color Mixer</h2>
            <div class="mixer-top">
                <div class="flashlight-container">
                    <!-- Flashlights -->
                    <div class="flashlight red-flashlight">
                        <div class="flashlight-head"></div>
                        <div class="flashlight-lens"></div>
                        <div class="flashlight-body"></div>
                    </div>
                    <div class="flashlight green-flashlight">
                        <div class="flashlight-head"></div>
                        <div class="flashlight-lens"></div>
                        <div class="flashlight-body"></div>
                    </div>
                    <div class="flashlight blue-flashlight">
                        <div class="flashlight-head"></div>
                        <div class="flashlight-lens"></div>
                        <div class="flashlight-body"></div>
                    </div>

                    <!-- Light beams -->
                    <div class="light-stage">
                        <div class="light-beam red" id="redBeam"></div>
                        <div class="light-beam green" id="greenBeam"></div>
                        <div class="light-beam blue" id="blueBeam"></div>
                    </div>

                    <!-- Mix point indicator -->
                    <div class="mix-point" id="mixPoint"></div>

                    <!-- Color result display -->
                    <div class="color-result" id="previewHex">#FF0000</div>
                </div>

                <div class="primary-pickers-wrapper">
                    <div class="primary-picker">
                        <span class="primary-picker-label">Primary 1</span>
                        <div class="primary-picker-buttons">
                            <button class="primary-btn red-btn selected" data-color="red" onclick="setPrimary(1, 'red')">R</button>
                            <button class="primary-btn green-btn" data-color="green" onclick="setPrimary(1, 'green')">G</button>
                            <button class="primary-btn blue-btn" data-color="blue" onclick="setPrimary(1, 'blue')">B</button>
                        </div>
                    </div>
                    <div class="primary-picker">
                        <span class="primary-picker-label">Primary 2</span>
                        <div class="primary-picker-buttons">
                            <button class="primary-btn red-btn" data-color="red" onclick="setPrimary(2, 'red')">R</button>
                            <button class="primary-btn green-btn selected" data-color="green" onclick="setPrimary(2, 'green')">G</button>
                            <button class="primary-btn blue-btn" data-color="blue" onclick="setPrimary(2, 'blue')">B</button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="sliders-and-values">
                <div class="sliders-container">
                    <div class="slider-group" id="redSliderGroup">
                        <div class="slider-label">
                            <span style="color: #ff6b6b;">Red</span>
                            <span id="redValue">255</span>
                        </div>
                        <div class="slider-wrapper" id="redSliderWrapper">
                            <input type="range" min="0" max="255" value="255" class="red-slider" id="redSlider">
                            <div class="cap-marker" id="redCapMarker" style="display: none;"></div>
                            <div class="slider-disabled-zone" id="redDisabledZone" style="display: none;"></div>
                        </div>
                    </div>

                    <div class="slider-group" id="greenSliderGroup">
                        <div class="slider-label">
                            <span style="color: #4ecdc4;">Green</span>
                            <span id="greenValue">0</span>
                        </div>
                        <div class="slider-wrapper" id="greenSliderWrapper">
                            <input type="range" min="0" max="255" value="0" class="green-slider" id="greenSlider">
                            <div class="cap-marker" id="greenCapMarker" style="display: none;"></div>
                            <div class="slider-disabled-zone" id="greenDisabledZone" style="display: none;"></div>
                        </div>
                    </div>

                    <div class="slider-group lightness-slider" id="blueSliderGroup">
                        <div class="slider-label">
                            <span style="color: #45b7d1;">Blue</span>
                            <span id="blueValue">0</span>
                        </div>
                        <div class="slider-wrapper" id="blueSliderWrapper">
                            <input type="range" min="0" max="255" value="0" class="blue-slider" id="blueSlider">
                            <div class="cap-marker" id="blueCapMarker" style="display: none;"></div>
                            <div class="slider-disabled-zone" id="blueDisabledZone" style="display: none;"></div>
                        </div>
                    </div>
                </div>

                <div class="color-values">
                    <div class="color-value-box">
                        <label>HEX</label>
                        <span id="hexCode">#FF0000</span>
                    </div>
                    <div class="color-value-box">
                        <label>RGB</label>
                        <span id="rgbCode">255, 0, 0</span>
                    </div>
                    <div class="color-value-box">
                        <label>HSL</label>
                        <span id="hslCode">0°, 100%, 50%</span>
                    </div>
                </div>
            </div>

            <div class="color-explanation" id="colorExplanation">
                <span class="mix-result" id="mixResultText">Red + Green = Yellow.</span>
                <span id="lightnessText">Blue adds lightness toward white.</span>
            </div>

            <!-- Color Wheel Discovery -->
            <div class="color-wheel-section">
                <h3>Colors Discovered</h3>
                <div class="color-wheel-row">
                    <div class="color-wheel-container">
                        <canvas id="colorWheel" width="420" height="420"></canvas>
                        <canvas id="colorWheelFull" width="420" height="420" style="display: none;"></canvas>
                        <div class="wheel-center"></div>
                    </div>
                    <div class="wheel-side-controls">
                        <p class="colors-discovered"><span id="colorCount">0</span> colors discovered</p>
                        <button class="btn-secondary reveal-btn" id="revealBtn" onclick="toggleRevealWheel()">Reveal Full Wheel</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Palette Generator & Accessibility Panel -->
        <div class="panel">
            <h2>Palette & Accessibility</h2>

            <!-- Palette Generation Section -->
            <div class="palette-controls">
                <select class="palette-type-select" id="paletteType" onchange="generatePalette()">
                    <option value="complementary">Complementary</option>
                    <option value="triadic">Triadic</option>
                    <option value="analogous">Analogous</option>
                    <option value="split-complementary">Split Complementary</option>
                    <option value="tetradic">Tetradic</option>
                    <option value="monochromatic">Monochromatic</option>
                </select>
            </div>

            <div class="palette-display" id="paletteDisplay">
                <!-- Palette colors will be generated here -->
            </div>

            <div style="margin-top: 20px; margin-bottom: 25px;">
                <h3 style="font-size: 1rem; margin-bottom: 10px;">Accessible Mode</h3>
                <div class="mode-selector">
                    <button class="btn-secondary mode-btn" id="modeOff" onclick="setAccessibleMode('off')">Off</button>
                    <button class="btn-secondary mode-btn" id="modeAA" onclick="setAccessibleMode('AA')">AA</button>
                    <button class="btn-secondary mode-btn" id="modeAAA" onclick="setAccessibleMode('AAA')">AAA</button>
                </div>
                <p style="font-size: 0.8rem; color: #888;">Adjust palette colors to meet WCAG contrast requirements.</p>
            </div>

            <!-- Divider -->
            <div style="border-top: 1px solid rgba(255,255,255,0.1); margin: 20px 0;"></div>

            <!-- Contrast Checker Section -->
            <h3 style="font-size: 1.1rem; margin-bottom: 15px; display: flex; align-items: center; gap: 8px;"><span>✓</span> Contrast Checker</h3>

            <p style="font-size: 0.85rem; color: #888; margin-bottom: 12px;">Click palette colors above to select them:</p>
            <div class="select-mode-btns" style="margin-bottom: 20px;">
                <button class="btn-secondary select-mode-btn active-text" id="selectTextBtn" onclick="setSelectMode('text')">Set as Text</button>
                <button class="btn-secondary select-mode-btn" id="selectBgBtn" onclick="setSelectMode('bg')">Set as Background</button>
            </div>

            <div class="contrast-colors">
                <div class="contrast-color-picker">
                    <label>Text Color</label>
                    <input type="color" id="textColor" value="#000000">
                    <input type="text" class="hex-input" id="textHexInput" value="#000000" placeholder="#000000" maxlength="7">
                </div>
                <div class="contrast-color-picker">
                    <label>Background Color</label>
                    <input type="color" id="bgColor" value="#ffffff">
                    <input type="text" class="hex-input" id="bgHexInput" value="#FFFFFF" placeholder="#FFFFFF" maxlength="7">
                </div>
            </div>

            <div class="contrast-preview" id="contrastPreview">
                <p>Lorem ipsum dolor sit amet consectetur adipiscing elit.</p>
            </div>

            <div class="contrast-result">
                <div class="contrast-ratio" id="contrastRatio">21.00:1</div>
                <div class="wcag-results">
                    <div class="wcag-item" id="aaNormal">
                        <div class="level">AA Normal</div>
                        <div class="status">4.5:1 required</div>
                    </div>
                    <div class="wcag-item" id="aaLarge">
                        <div class="level">AA Large</div>
                        <div class="status">3:1 required</div>
                    </div>
                    <div class="wcag-item" id="aaaNormal">
                        <div class="level">AAA Normal</div>
                        <div class="status">7:1 required</div>
                    </div>
                    <div class="wcag-item" id="aaaLarge">
                        <div class="level">AAA Large</div>
                        <div class="status">4.5:1 required</div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- Color Blindness Side Panel Toggle -->
    <button class="side-panel-toggle" id="sidePanelToggle" onclick="toggleSidePanel()">
        <span class="menu-line"></span>
        <span class="menu-line"></span>
        <span class="menu-line"></span>
    </button>

    <!-- Color Blindness Simulator Side Panel -->
    <div class="side-panel" id="sidePanel">
        <button class="side-panel-close" onclick="toggleSidePanel()">&times;</button>
        <h2>Color Blindness Simulator</h2>
        <p style="color: #888; margin-bottom: 15px; font-size: 0.9rem;">Select a type of color vision deficiency:</p>

        <div class="blindness-options" id="blindnessOptions">
            <!-- Options will be generated here -->
        </div>
    </div>

    <div class="copy-notification" id="copyNotification">Color copied to clipboard!</div>

    <script>
        // State
        let currentColor = { r: 255, g: 0, b: 0 };
        let accessibleMode = 'off';
        let currentPaletteColors = [];
        let contrastSelectMode = 'text'; // 'text' or 'bg'
        let selectedBlindnessType = 'normal';
        let activeColors = { red: true, green: true, blue: false };
        let discoveredColors = new Set();

        // Color blindness types
        const blindnessTypes = [
            { key: 'normal', name: 'Normal Vision', desc: 'Full color perception' },
            { key: 'protanopia', name: 'Protanopia', desc: 'Red-blind, affects ~1% of males' },
            { key: 'deuteranopia', name: 'Deuteranopia', desc: 'Green-blind, affects ~1% of males' },
            { key: 'tritanopia', name: 'Tritanopia', desc: 'Blue-blind, very rare condition' },
            { key: 'protanomaly', name: 'Protanomaly', desc: 'Red-weak, affects ~1% of males' },
            { key: 'deuteranomaly', name: 'Deuteranomaly', desc: 'Green-weak, affects ~5% of males' },
            { key: 'tritanomaly', name: 'Tritanomaly', desc: 'Blue-weak, very rare condition' },
            { key: 'achromatopsia', name: 'Achromatopsia', desc: 'Complete color blindness, monochrome vision' }
        ];

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            setupSliders();
            setupContrastChecker();
            initColorWheel();
            updatePrimaryButtons();
            updateSliders();
            updateAllDisplays();
            generatePalette();
            document.getElementById('modeOff').classList.add('active');
        });

        // Color Wheel functions
        let wheelRevealed = false;

        function initColorWheel() {
            const canvas = document.getElementById('colorWheel');
            const ctx = canvas.getContext('2d');
            // Draw dark background wheel
            ctx.fillStyle = '#111';
            ctx.beginPath();
            ctx.arc(210, 210, 210, 0, Math.PI * 2);
            ctx.fill();

            // Draw the full color wheel (hidden initially)
            drawFullColorWheel();
        }

        function drawFullColorWheel() {
            const canvas = document.getElementById('colorWheelFull');
            const ctx = canvas.getContext('2d');
            const centerX = 210;
            const centerY = 210;
            const radius = 210;

            // Draw color wheel using HSL
            for (let angle = 0; angle < 360; angle++) {
                const startAngle = (angle - 91) * Math.PI / 180;
                const endAngle = (angle - 89) * Math.PI / 180;

                // Draw gradient from center outward for saturation
                for (let r = 52; r < radius; r += 2) {
                    const saturation = ((r - 52) / (radius - 52)) * 100;
                    const lightness = 50;

                    ctx.beginPath();
                    ctx.arc(centerX, centerY, r, startAngle, endAngle);
                    ctx.strokeStyle = `hsl(${angle}, ${saturation}%, ${lightness}%)`;
                    ctx.lineWidth = 3;
                    ctx.stroke();
                }
            }
        }

        function toggleRevealWheel() {
            wheelRevealed = !wheelRevealed;
            const fullWheel = document.getElementById('colorWheelFull');
            const discoveredWheel = document.getElementById('colorWheel');
            const btn = document.getElementById('revealBtn');

            if (wheelRevealed) {
                fullWheel.style.display = 'block';
                discoveredWheel.style.display = 'none';
                btn.textContent = 'Show Discovered Only';
                btn.classList.add('active');
            } else {
                fullWheel.style.display = 'none';
                discoveredWheel.style.display = 'block';
                btn.textContent = 'Reveal Full Wheel';
                btn.classList.remove('active');
            }
        }

        // Side panel toggle
        function toggleSidePanel() {
            const panel = document.getElementById('sidePanel');
            const toggle = document.getElementById('sidePanelToggle');
            panel.classList.toggle('open');
            toggle.classList.toggle('open');
        }

        function addDiscoveredColor(r, g, b) {
            // Create a simplified color key (reduce precision to group similar colors)
            const key = `${Math.round(r/8)*8},${Math.round(g/8)*8},${Math.round(b/8)*8}`;

            if (!discoveredColors.has(key)) {
                discoveredColors.add(key);
                drawColorOnWheel(r, g, b);
                document.getElementById('colorCount').textContent = discoveredColors.size;
            }
        }

        function drawColorOnWheel(r, g, b) {
            const canvas = document.getElementById('colorWheel');
            const ctx = canvas.getContext('2d');

            // Convert RGB to HSL to get the hue angle
            const hsl = rgbToHsl(r, g, b);
            const hue = hsl.h;
            const sat = hsl.s;
            const light = hsl.l;

            // Calculate position on wheel based on hue and saturation
            const angle = (hue - 90) * (Math.PI / 180); // Offset so red is at top
            const radius = 63 + (sat / 100) * 126; // Distance from center based on saturation

            const centerX = 210;
            const centerY = 210;
            const x = centerX + Math.cos(angle) * radius;
            const y = centerY + Math.sin(angle) * radius;

            // Draw the color dot
            ctx.fillStyle = `rgb(${r}, ${g}, ${b})`;
            ctx.beginPath();
            ctx.arc(x, y, 13, 0, Math.PI * 2);
            ctx.fill();

            // Add a slight glow effect
            ctx.shadowColor = `rgb(${r}, ${g}, ${b})`;
            ctx.shadowBlur = 15;
            ctx.beginPath();
            ctx.arc(x, y, 11, 0, Math.PI * 2);
            ctx.fill();
            ctx.shadowBlur = 0;
        }

        // Primary color selection
        let primary1 = 'red';
        let primary2 = 'green';

        function setPrimary(slot, color) {
            if (slot === 1) {
                if (color === primary2) {
                    // Swap if selecting the same as primary2
                    primary2 = primary1;
                }
                primary1 = color;
            } else {
                if (color === primary1) {
                    // Swap if selecting the same as primary1
                    primary1 = primary2;
                }
                primary2 = color;
            }

            // Update activeColors based on primaries
            activeColors = { red: false, green: false, blue: false };
            activeColors[primary1] = true;
            activeColors[primary2] = true;

            updatePrimaryButtons();
            updateSliders();
            updateAllDisplays();
        }

        function updatePrimaryButtons() {
            const colors = ['red', 'green', 'blue'];

            // Update Primary 1 buttons - disable the one selected in Primary 2
            document.querySelectorAll('.primary-picker:first-child .primary-btn').forEach(btn => {
                const color = btn.dataset.color;
                btn.classList.toggle('selected', color === primary1);
                btn.disabled = (color === primary2);
            });

            // Update Primary 2 buttons - disable the one selected in Primary 1
            document.querySelectorAll('.primary-picker:last-child .primary-btn').forEach(btn => {
                const color = btn.dataset.color;
                btn.classList.toggle('selected', color === primary2);
                btn.disabled = (color === primary1);
            });
        }

        function updateSliders() {
            const colors = ['red', 'green', 'blue'];
            const lightnessColor = colors.find(c => !activeColors[c]);

            // Get the minimum value of the two primary colors
            const primaryValues = [primary1, primary2].map(c => currentColor[c[0]]);
            const maxLightnessValue = Math.min(...primaryValues);

            colors.forEach(color => {
                const sliderGroup = document.getElementById(`${color}SliderGroup`);
                const slider = document.getElementById(`${color}Slider`);
                const capMarker = document.getElementById(`${color}CapMarker`);
                const disabledZone = document.getElementById(`${color}DisabledZone`);

                if (activeColors[color]) {
                    // Primary color
                    sliderGroup.classList.remove('lightness-slider');
                    slider.max = 255;
                    slider.style.width = '100%';
                    slider.classList.remove('capped');
                    capMarker.style.display = 'none';
                    disabledZone.style.display = 'none';
                } else {
                    // Lightness color
                    sliderGroup.classList.add('lightness-slider');

                    // Keep max at maxLightnessValue and shrink slider width
                    slider.max = maxLightnessValue;

                    // Show and position cap marker and disabled zone
                    if (maxLightnessValue < 255) {
                        const capPercent = (maxLightnessValue / 255) * 100;

                        // Shrink slider to only cover allowed range
                        slider.style.width = `${capPercent}%`;
                        slider.classList.add('capped');

                        if (maxLightnessValue > 0) {
                            capMarker.style.display = 'block';
                            capMarker.style.left = `calc(${capPercent}% - 1.5px)`;
                        } else {
                            capMarker.style.display = 'none';
                            slider.style.width = '0%';
                        }

                        // Show disabled zone past the cap
                        disabledZone.style.display = 'block';
                        disabledZone.style.width = `${100 - capPercent}%`;
                    } else {
                        slider.style.width = '100%';
                        slider.classList.remove('capped');
                        capMarker.style.display = 'none';
                        disabledZone.style.display = 'none';
                    }

                    // Cap current value if needed
                    if (currentColor[color[0]] > maxLightnessValue) {
                        currentColor[color[0]] = maxLightnessValue;
                        slider.value = maxLightnessValue;
                        document.getElementById(`${color}Value`).textContent = maxLightnessValue;
                    }
                }
            });

            updateColorExplanation();
        }

        function updateColorExplanation() {
            const colorNames = { red: 'Red', green: 'Green', blue: 'Blue' };
            const colorEmojis = {
                'red+green': 'Yellow',
                'red+blue': 'Magenta',
                'green+blue': 'Cyan',
                'green+red': 'Yellow',
                'blue+red': 'Magenta',
                'blue+green': 'Cyan'
            };

            const lightnessColor = ['red', 'green', 'blue'].find(c => !activeColors[c]);
            const mixKey = `${primary1}+${primary2}`;
            const resultColor = colorEmojis[mixKey] || 'a new color';

            document.getElementById('mixResultText').textContent =
                `${colorNames[primary1]} + ${colorNames[primary2]} = ${resultColor}.`;
            document.getElementById('lightnessText').textContent =
                `${colorNames[lightnessColor]} adds lightness toward white.`;
        }

        // Slider setup
        function setupSliders() {
            const sliders = ['red', 'green', 'blue'];
            sliders.forEach(color => {
                const slider = document.getElementById(`${color}Slider`);

                const handleSliderInput = (e) => {
                    let value = parseInt(e.target.value);

                    // Enforce max limit for lightness (non-primary) color
                    if (!activeColors[color]) {
                        const primaryValues = [primary1, primary2].map(c => currentColor[c[0]]);
                        const maxAllowed = Math.min(...primaryValues);
                        if (value > maxAllowed) {
                            value = maxAllowed;
                            e.target.value = value;
                        }
                    }

                    currentColor[color[0]] = value;
                    document.getElementById(`${color}Value`).textContent = value;
                    // Update the lightness slider's max limit when primary colors change
                    if (activeColors[color]) {
                        updateSliders();
                    }
                    updateAllDisplays();
                };

                slider.addEventListener('input', handleSliderInput);
                slider.addEventListener('change', handleSliderInput);

                // Also prevent going past max using mouseup/touchend
                slider.addEventListener('mouseup', () => {
                    if (!activeColors[color]) {
                        const primaryValues = [primary1, primary2].map(c => currentColor[c[0]]);
                        const maxAllowed = Math.min(...primaryValues);
                        if (parseInt(slider.value) > maxAllowed) {
                            slider.value = maxAllowed;
                            currentColor[color[0]] = maxAllowed;
                            document.getElementById(`${color}Value`).textContent = maxAllowed;
                            updateAllDisplays();
                        }
                    }
                });
            });

            // Set initial slider values based on active colors
            document.getElementById('redSlider').value = 255;
            document.getElementById('redValue').textContent = '255';
            document.getElementById('greenSlider').value = 255;
            document.getElementById('greenValue').textContent = '255';
            currentColor = { r: 255, g: 255, b: 0 };
        }

        // Contrast checker setup
        function setupContrastChecker() {
            // Color picker listeners
            document.getElementById('textColor').addEventListener('input', (e) => {
                document.getElementById('textHexInput').value = e.target.value.toUpperCase();
                updateContrastChecker();
            });
            document.getElementById('bgColor').addEventListener('input', (e) => {
                document.getElementById('bgHexInput').value = e.target.value.toUpperCase();
                updateContrastChecker();
            });

            // Hex input listeners
            document.getElementById('textHexInput').addEventListener('input', (e) => {
                handleHexInput(e.target, 'textColor');
            });
            document.getElementById('bgHexInput').addEventListener('input', (e) => {
                handleHexInput(e.target, 'bgColor');
            });

            updateContrastChecker();
        }

        function handleHexInput(input, colorPickerId) {
            let value = input.value.trim();

            // Add # if missing
            if (value && !value.startsWith('#')) {
                value = '#' + value;
            }

            // Validate hex format
            const isValid = /^#[0-9A-Fa-f]{6}$/.test(value);

            if (isValid) {
                input.classList.remove('invalid');
                document.getElementById(colorPickerId).value = value;
                input.value = value.toUpperCase();
                updateContrastChecker();
            } else if (value.length > 0) {
                input.classList.add('invalid');
            } else {
                input.classList.remove('invalid');
            }
        }

        function setSelectMode(mode) {
            contrastSelectMode = mode;
            const textBtn = document.getElementById('selectTextBtn');
            const bgBtn = document.getElementById('selectBgBtn');

            textBtn.classList.remove('active-text');
            bgBtn.classList.remove('active-bg');

            if (mode === 'text') {
                textBtn.classList.add('active-text');
            } else {
                bgBtn.classList.add('active-bg');
            }
        }

        function selectPaletteColorForContrast(hex) {
            if (contrastSelectMode === 'text') {
                document.getElementById('textColor').value = hex;
                document.getElementById('textHexInput').value = hex.toUpperCase();
            } else {
                document.getElementById('bgColor').value = hex;
                document.getElementById('bgHexInput').value = hex.toUpperCase();
            }
            updateContrastChecker();
            updatePaletteHighlights();
        }

        function updatePaletteHighlights() {
            const textColor = document.getElementById('textColor').value.toUpperCase();
            const bgColor = document.getElementById('bgColor').value.toUpperCase();

            document.querySelectorAll('.palette-color').forEach(el => {
                el.classList.remove('selected-text', 'selected-bg');
                // Remove old indicators
                el.querySelectorAll('.selection-indicator').forEach(ind => ind.remove());

                const colorHex = el.dataset.hex ? el.dataset.hex.toUpperCase() : '';

                if (colorHex === textColor) {
                    el.classList.add('selected-text');
                    const indicator = document.createElement('span');
                    indicator.className = 'selection-indicator text-indicator';
                    indicator.textContent = 'T';
                    el.appendChild(indicator);
                }
                if (colorHex === bgColor) {
                    el.classList.add('selected-bg');
                    const indicator = document.createElement('span');
                    indicator.className = 'selection-indicator bg-indicator';
                    indicator.textContent = 'BG';
                    el.appendChild(indicator);
                }
            });
        }

        // Update all displays
        function updateAllDisplays() {
            const hex = rgbToHex(currentColor.r, currentColor.g, currentColor.b);
            const hsl = rgbToHsl(currentColor.r, currentColor.g, currentColor.b);

            // Update flashlight beam intensities
            document.getElementById('redBeam').style.opacity = currentColor.r / 255;
            document.getElementById('greenBeam').style.opacity = currentColor.g / 255;
            document.getElementById('blueBeam').style.opacity = currentColor.b / 255;

            // Update mix point color
            const mixPoint = document.getElementById('mixPoint');
            mixPoint.style.backgroundColor = hex;
            mixPoint.style.boxShadow = `0 0 20px ${hex}, 0 0 40px ${hex}, inset 0 0 15px rgba(0,0,0,0.3)`;

            // Update hex display
            document.getElementById('previewHex').textContent = hex;

            // Update value displays
            document.getElementById('hexCode').textContent = hex;
            document.getElementById('rgbCode').textContent = `${currentColor.r}, ${currentColor.g}, ${currentColor.b}`;
            document.getElementById('hslCode').textContent = `${Math.round(hsl.h)}°, ${Math.round(hsl.s)}%, ${Math.round(hsl.l)}%`;

            // Add to discovered colors on the wheel
            if (currentColor.r > 0 || currentColor.g > 0 || currentColor.b > 0) {
                addDiscoveredColor(currentColor.r, currentColor.g, currentColor.b);
            }

            // Update color blindness simulation
            updateColorBlindnessSimulation();
        }

        // Color conversion utilities
        function rgbToHex(r, g, b) {
            return '#' + [r, g, b].map(x => x.toString(16).padStart(2, '0')).join('').toUpperCase();
        }

        function hexToRgb(hex) {
            const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            return result ? {
                r: parseInt(result[1], 16),
                g: parseInt(result[2], 16),
                b: parseInt(result[3], 16)
            } : null;
        }

        function rgbToHsl(r, g, b) {
            r /= 255; g /= 255; b /= 255;
            const max = Math.max(r, g, b), min = Math.min(r, g, b);
            let h, s, l = (max + min) / 2;

            if (max === min) {
                h = s = 0;
            } else {
                const d = max - min;
                s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
                switch (max) {
                    case r: h = ((g - b) / d + (g < b ? 6 : 0)) / 6; break;
                    case g: h = ((b - r) / d + 2) / 6; break;
                    case b: h = ((r - g) / d + 4) / 6; break;
                }
            }
            return { h: h * 360, s: s * 100, l: l * 100 };
        }

        function hslToRgb(h, s, l) {
            h /= 360; s /= 100; l /= 100;
            let r, g, b;

            if (s === 0) {
                r = g = b = l;
            } else {
                const hue2rgb = (p, q, t) => {
                    if (t < 0) t += 1;
                    if (t > 1) t -= 1;
                    if (t < 1/6) return p + (q - p) * 6 * t;
                    if (t < 1/2) return q;
                    if (t < 2/3) return p + (q - p) * (2/3 - t) * 6;
                    return p;
                };
                const q = l < 0.5 ? l * (1 + s) : l + s - l * s;
                const p = 2 * l - q;
                r = hue2rgb(p, q, h + 1/3);
                g = hue2rgb(p, q, h);
                b = hue2rgb(p, q, h - 1/3);
            }
            return {
                r: Math.round(r * 255),
                g: Math.round(g * 255),
                b: Math.round(b * 255)
            };
        }

        // Palette generation
        function generatePalette() {
            const type = document.getElementById('paletteType').value;
            const hsl = rgbToHsl(currentColor.r, currentColor.g, currentColor.b);
            let colors = [];

            switch(type) {
                case 'complementary':
                    colors = [
                        hsl,
                        { h: (hsl.h + 180) % 360, s: hsl.s, l: hsl.l }
                    ];
                    break;
                case 'triadic':
                    colors = [
                        hsl,
                        { h: (hsl.h + 120) % 360, s: hsl.s, l: hsl.l },
                        { h: (hsl.h + 240) % 360, s: hsl.s, l: hsl.l }
                    ];
                    break;
                case 'analogous':
                    colors = [
                        { h: (hsl.h - 30 + 360) % 360, s: hsl.s, l: hsl.l },
                        hsl,
                        { h: (hsl.h + 30) % 360, s: hsl.s, l: hsl.l }
                    ];
                    break;
                case 'split-complementary':
                    colors = [
                        hsl,
                        { h: (hsl.h + 150) % 360, s: hsl.s, l: hsl.l },
                        { h: (hsl.h + 210) % 360, s: hsl.s, l: hsl.l }
                    ];
                    break;
                case 'tetradic':
                    colors = [
                        hsl,
                        { h: (hsl.h + 90) % 360, s: hsl.s, l: hsl.l },
                        { h: (hsl.h + 180) % 360, s: hsl.s, l: hsl.l },
                        { h: (hsl.h + 270) % 360, s: hsl.s, l: hsl.l }
                    ];
                    break;
                case 'monochromatic':
                    colors = [
                        { h: hsl.h, s: hsl.s, l: Math.max(20, hsl.l - 30) },
                        { h: hsl.h, s: hsl.s, l: Math.max(30, hsl.l - 15) },
                        hsl,
                        { h: hsl.h, s: hsl.s, l: Math.min(70, hsl.l + 15) },
                        { h: hsl.h, s: hsl.s, l: Math.min(85, hsl.l + 30) }
                    ];
                    break;
            }

            // Apply accessible mode if enabled
            if (accessibleMode !== 'off') {
                colors = colors.map(c => adjustForAccessibility(c, accessibleMode));
            }

            displayPalette(colors);
        }

        function adjustForAccessibility(hslColor, mode) {
            const requiredRatio = mode === 'AAA' ? 7 : 4.5;
            let adjustedColor = { ...hslColor };

            // Check contrast with white and black text
            const rgb = hslToRgb(hslColor.h, hslColor.s, hslColor.l);
            const hex = rgbToHex(rgb.r, rgb.g, rgb.b);

            const contrastWithWhite = getContrastRatio('#FFFFFF', hex);
            const contrastWithBlack = getContrastRatio('#000000', hex);

            // If neither passes, adjust lightness
            if (contrastWithWhite < requiredRatio && contrastWithBlack < requiredRatio) {
                // Determine which direction to adjust
                if (hslColor.l > 50) {
                    // Darker color - need good contrast with white, make it darker
                    while (adjustedColor.l > 5) {
                        adjustedColor.l -= 5;
                        const testRgb = hslToRgb(adjustedColor.h, adjustedColor.s, adjustedColor.l);
                        const testHex = rgbToHex(testRgb.r, testRgb.g, testRgb.b);
                        if (getContrastRatio('#FFFFFF', testHex) >= requiredRatio) break;
                    }
                } else {
                    // Lighter color - need good contrast with black, make it lighter
                    while (adjustedColor.l < 95) {
                        adjustedColor.l += 5;
                        const testRgb = hslToRgb(adjustedColor.h, adjustedColor.s, adjustedColor.l);
                        const testHex = rgbToHex(testRgb.r, testRgb.g, testRgb.b);
                        if (getContrastRatio('#000000', testHex) >= requiredRatio) break;
                    }
                }
            }

            return adjustedColor;
        }

        function displayPalette(colors) {
            const container = document.getElementById('paletteDisplay');
            container.innerHTML = '';
            currentPaletteColors = []; // Reset palette colors array

            colors.forEach(hslColor => {
                const rgb = hslToRgb(hslColor.h, hslColor.s, hslColor.l);
                const hex = rgbToHex(rgb.r, rgb.g, rgb.b);
                const brightness = (rgb.r * 299 + rgb.g * 587 + rgb.b * 114) / 1000;

                currentPaletteColors.push(hex); // Store for contrast checker

                const contrastWithWhite = getContrastRatio('#FFFFFF', hex);
                const contrastWithBlack = getContrastRatio('#000000', hex);

                let badge = '';
                if (accessibleMode !== 'off') {
                    const bestContrast = Math.max(contrastWithWhite, contrastWithBlack);
                    if (bestContrast >= 7) {
                        badge = '<span class="accessible-badge badge-aaa">AAA</span>';
                    } else if (bestContrast >= 4.5) {
                        badge = '<span class="accessible-badge badge-aa">AA</span>';
                    }
                }

                const colorDiv = document.createElement('div');
                colorDiv.className = 'palette-color';
                colorDiv.dataset.hex = hex;
                colorDiv.style.backgroundColor = hex;
                colorDiv.innerHTML = `${badge}<span style="color: ${brightness > 128 ? '#000' : '#fff'}">${hex}</span>`;
                colorDiv.onclick = () => selectPaletteColorForContrast(hex);
                container.appendChild(colorDiv);
            });

            // Update selection highlights on palette
            updatePaletteHighlights();
        }

        function setAccessibleMode(mode) {
            accessibleMode = mode;
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`mode${mode === 'off' ? 'Off' : mode}`).classList.add('active');
            generatePalette();
        }

        // Contrast checker
        function updateContrastChecker() {
            const textColor = document.getElementById('textColor').value;
            const bgColor = document.getElementById('bgColor').value;

            // Update preview
            const preview = document.getElementById('contrastPreview');
            preview.style.backgroundColor = bgColor;
            preview.style.color = textColor;

            // Calculate contrast ratio
            const ratio = getContrastRatio(textColor, bgColor);
            document.getElementById('contrastRatio').textContent = ratio.toFixed(2) + ':1';

            // Update WCAG results
            updateWcagResult('aaNormal', ratio >= 4.5);
            updateWcagResult('aaLarge', ratio >= 3);
            updateWcagResult('aaaNormal', ratio >= 7);
            updateWcagResult('aaaLarge', ratio >= 4.5);
        }

        function updateWcagResult(id, passes) {
            const element = document.getElementById(id);
            element.classList.remove('pass', 'fail');
            element.classList.add(passes ? 'pass' : 'fail');
            element.querySelector('.status').textContent = passes ? 'PASS ✓' : 'FAIL ✗';
        }

        function getContrastRatio(color1, color2) {
            const rgb1 = hexToRgb(color1);
            const rgb2 = hexToRgb(color2);

            const l1 = getRelativeLuminance(rgb1.r, rgb1.g, rgb1.b);
            const l2 = getRelativeLuminance(rgb2.r, rgb2.g, rgb2.b);

            const lighter = Math.max(l1, l2);
            const darker = Math.min(l1, l2);

            return (lighter + 0.05) / (darker + 0.05);
        }

        function getRelativeLuminance(r, g, b) {
            const [rs, gs, bs] = [r, g, b].map(c => {
                c = c / 255;
                return c <= 0.03928 ? c / 12.92 : Math.pow((c + 0.055) / 1.055, 2.4);
            });
            return 0.2126 * rs + 0.7152 * gs + 0.0722 * bs;
        }

        // Color blindness simulation
        function updateColorBlindnessSimulation() {
            renderBlindnessOptions();
        }

        function renderBlindnessOptions() {
            const container = document.getElementById('blindnessOptions');
            container.innerHTML = '';

            blindnessTypes.forEach((type) => {
                const option = document.createElement('div');
                option.className = `blindness-option${selectedBlindnessType === type.key ? ' selected' : ''}`;
                option.innerHTML = `
                    <div class="blindness-radio"></div>
                    <div class="blindness-label">
                        <strong>${type.name}</strong>
                        <span>${type.desc}</span>
                    </div>
                `;
                option.onclick = () => selectBlindnessType(type.key);
                container.appendChild(option);
            });
        }

        function selectBlindnessType(type) {
            selectedBlindnessType = type;

            // Remove all filter classes from body
            document.body.classList.remove(
                'filter-protanopia', 'filter-deuteranopia', 'filter-tritanopia',
                'filter-protanomaly', 'filter-deuteranomaly', 'filter-tritanomaly',
                'filter-achromatopsia'
            );

            // Apply the selected filter (normal has no filter)
            if (type !== 'normal') {
                document.body.classList.add(`filter-${type}`);
            }

            renderBlindnessOptions();
        }

        function simulateColorBlindness(rgb, type) {
            // Color blindness simulation matrices
            const matrices = {
                normal: [
                    [1, 0, 0],
                    [0, 1, 0],
                    [0, 0, 1]
                ],
                protanopia: [
                    [0.567, 0.433, 0],
                    [0.558, 0.442, 0],
                    [0, 0.242, 0.758]
                ],
                deuteranopia: [
                    [0.625, 0.375, 0],
                    [0.7, 0.3, 0],
                    [0, 0.3, 0.7]
                ],
                tritanopia: [
                    [0.95, 0.05, 0],
                    [0, 0.433, 0.567],
                    [0, 0.475, 0.525]
                ],
                protanomaly: [
                    [0.817, 0.183, 0],
                    [0.333, 0.667, 0],
                    [0, 0.125, 0.875]
                ],
                deuteranomaly: [
                    [0.8, 0.2, 0],
                    [0.258, 0.742, 0],
                    [0, 0.142, 0.858]
                ],
                tritanomaly: [
                    [0.967, 0.033, 0],
                    [0, 0.733, 0.267],
                    [0, 0.183, 0.817]
                ],
                achromatopsia: [
                    [0.299, 0.587, 0.114],
                    [0.299, 0.587, 0.114],
                    [0.299, 0.587, 0.114]
                ]
            };

            const matrix = matrices[type] || matrices.normal;

            const r = Math.round(Math.min(255, Math.max(0,
                matrix[0][0] * rgb.r + matrix[0][1] * rgb.g + matrix[0][2] * rgb.b)));
            const g = Math.round(Math.min(255, Math.max(0,
                matrix[1][0] * rgb.r + matrix[1][1] * rgb.g + matrix[1][2] * rgb.b)));
            const b = Math.round(Math.min(255, Math.max(0,
                matrix[2][0] * rgb.r + matrix[2][1] * rgb.g + matrix[2][2] * rgb.b)));

            return { r, g, b };
        }

        // Utility functions
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                const notification = document.getElementById('copyNotification');
                notification.textContent = `${text} copied to clipboard!`;
                notification.classList.add('show');
                setTimeout(() => notification.classList.remove('show'), 2000);
            });
        }
    </script>
</body>
</html>
